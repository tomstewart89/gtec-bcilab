
# Test EBML read and write

SET(TEST_NAME "EBML")

IF(WIN32)
	SET(EXT cmd)
	SET(OS_FLAGS "--no-pause")
ELSE(WIN32)
	SET(EXT sh)
	SET(OS_FLAGS "")
ENDIF(WIN32)

# Write test
ADD_TEST(run_${TEST_NAME}_write "$ENV{OV_BINARY_PATH}/test_ebml_write.${EXT}" ${OS_FLAGS} test_data.ebml)
SET_TESTS_PROPERTIES(run_${TEST_NAME}_write PROPERTIES ATTACHED_FILES_ON_FAIL "$ENV{OV_USERDATA}/log/openvibe-designer.log")

ADD_TEST(compare_${TEST_NAME}_write diff --strip-trailing-cr test_data.ebml ref_data.ebml)
SET_TESTS_PROPERTIES(compare_${TEST_NAME}_write PROPERTIES DEPENDS run_${TEST_NAME}_write})
SET_TESTS_PROPERTIES(compare_${TEST_NAME}_write PROPERTIES ATTACHED_FILES_ON_FAIL "$ENV{OV_USERDATA}/log/openvibe-designer.log")

# Read test, depends on write
ADD_TEST(run_${TEST_NAME}_read "$ENV{OV_BINARY_PATH}/test_ebml_read.${EXT}" ${OS_FLAGS} test_data.ebml read_result.txt)
SET_TESTS_PROPERTIES(run_${TEST_NAME}_read PROPERTIES DEPENDS run_${TEST_NAME}_write})
SET_TESTS_PROPERTIES(run_${TEST_NAME}_read PROPERTIES ATTACHED_FILES_ON_FAIL "$ENV{OV_USERDATA}/log/openvibe-designer.log")

ADD_TEST(compare_${TEST_NAME}_read diff --strip-trailing-cr read_result.txt ref_result.txt)
SET_TESTS_PROPERTIES(compare_${TEST_NAME}_read PROPERTIES DEPENDS run_${TEST_NAME}_read})
SET_TESTS_PROPERTIES(compare_${TEST_NAME}_read PROPERTIES ATTACHED_FILES_ON_FAIL "$ENV{OV_USERDATA}/log/openvibe-designer.log")

